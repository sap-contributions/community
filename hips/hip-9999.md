---
hip: "9999"
title: "Add export-values directive (similar to import-values)"
authors: [ "Jan von Loewenstein <jan.von.loewenstein@sap.com>", "Johannes Dillmann <j.dillmann@sap.com>", "Pavel Busko <pavel.busko@sap.com>", "Philipp Stehle <philipp.stehle@sap.com>", "Ralf Pannemans <ralf.pannemans@sap.com>", "Sumit Kulhadia <sumit.kulhadia@sap.com>" ]
created: "2022-02-01"
type: "feature"
status: "draft"
---

## Abstract

Composing Helm charts is currently limited because values can only be distributed from a subchart to the parent chart via the [`import-values`][import-values] directive.

This HIP describes the `export-values` directive which is similar to the `import-values`[import-values] directive, and allows exporting values from the parent chart to the subchart and defining the name under which it should be available.

With that the composite chart can define the values freely and is not limited to stick to the structure defined in the subchart. In some cases, this would result in a better user experience.

This change was discussed in helm/#3242. There were several attempts to implement this: helm/#7477, helm/#3243.

## Specification

```yaml
# values.yaml
port: 8080
```

The user can specify the value to be exported (`parent`) and where it should be exported in the subchart (`child`).

```yaml
# Chart.yaml:
dependencies:
  - name: client
    version: 1.0.0
    export-values:
    - parent: "port"
      child: "port"
  - name: server
    version: 1.0.0
    export-values:
    - parent: "port"
      child: "port"
```

### Desired Evaluation Order

1. Composite chart receives values
   1. Explicitly set via `--set KEY=VALUE` flag(s)
   1. Explicitly set via `--values` flag(s)
   1. Chart defaults (`values.yaml`)
1. Subchart receives values

### Value Precedence

1. Explicitly set for composit value (`port`)
1. Explicitly set for subchart value (`client.port`)
1. default for composit value (`values.yaml` in composite chart)
1. default for subchart value (`values.yaml` in subchart)

### Combination with `import-values`

It should be able to use both, `export-values` and `import-values`, indepentently and in combination. It should also be possible to export a value which was imported from third chart.

## Motivation

Currently, it is not possible to create a composite chart without leaking the structure of the values of the subcharts used. This would allow to freely structure the values the user interacts with.

## Rationale

Using the same composite chart as in the [specification](#specification) without `export-value`, the `port` value must match and must be specified twice by the user.

```yaml
# values.yaml
client:
  port: 8080

server:
  port: 8080
```

The proposed structure is not only cleaner for the user, but also less error prone since the port value is only maintained once.

## Backwards Compatibility

This change won't break any existing Helm chart since it only adds new mechanisms.

## Reference Implementation

TBD

[helm/#3242]: https://github.com/helm/helm/issues/3242
[import-values]: https://helm.sh/docs/topics/charts/#importing-child-values-via-dependencies
