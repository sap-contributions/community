---
hip: "9999"
title: "Add export-values directive (similar to import-values)"
authors: [ "Jan von Loewenstein <jan.von.loewenstein@sap.com>", "Johannes Dillmann <j.dillmann@sap.com>", "Pavel Busko <pavel.busko@sap.com>", "Philipp Stehle <philipp.stehle@sap.com>", "Ralf Pannemans <ralf.pannemans@sap.com>", "Sumit Kulhadia <sumit.kulhadia@sap.com>" ]
created: "2022-02-01"
type: "feature"
status: "draft"
---

## Abstract

Composing Helm charts using dependencies is currently limited because it is not possible to create a chart with a defined set of values and distribute them to subcharts. Users of a parent chart instead have to provide values to the subcharts directly. Alternatively, users can provide `global` values, but in that case the subcharts need to be aware of the fact that they are used as a dependency. In addition, `global` values are available globally as the name suggests and hence multiple subcharts have to have aligned value keys. As a result, the parent chart and it's dependencies are rather tightly coupled.

With the `import-values` directive, there is a mechanism in Helm to use the default values of a subchart as a value in the parent chart and define the name under which the subchart value is available in the parent chart.
This HIP describes the `export-values` directive which is similar to the [`import-values`](https://helm.sh/docs/topics/charts/#importing-child-values-via-dependencies) directive, and allows exporting values from the parent chart to the subchart and defining the name under which it should be available.
With that the values of the parent chart and the values of the subcharts can be defined independently. Subcharts can use their local values exclusively and don't have to be aware of the usage as a subchart. Parent charts on the other hand, can provide a consistent configuration api to their users and orchestrate the exchange of values between the subcharts using `export-values`, `import-values` or a combination thereof.

This change was discussed in [helm/#3242]. There were several attempts to implement this: [helm/#7477], [helm/#10059].

## Specification

With the proposed `export-values` directive, users are able to specify in the **parent** chart (snippet below) which and where values should be exported to the **subchart**.

```yaml
# Chart.yaml:
dependencies:
  - name: client
    version: 1.0.0
    export-values:
    - parent: "port"
      child: "port"
  - name: server
    version: 1.0.0
    export-values:
    - parent: "port"
      child: "port"
```

```yaml
# values.yaml
port: 8080
```

### Desired Evaluation Order

1. Parent chart receives values
   1. Explicitly set via `--set KEY=VALUE` flag(s)
   1. Explicitly set via `--values` flag(s)
   1. Chart defaults (`values.yaml`)
1. Subchart receives values

### Value Precedence

1. Explicitly set for parent chart's value (`port`)
1. Explicitly set for subchart value (`client.port`)
1. default for parent chart's value (`values.yaml` in parent chart)
1. default for subchart value (`values.yaml` in subchart)

### Combination with `import-values`

It should be able to use both, `export-values` and `import-values`, independently and in combination. It should also be possible to export a value which was imported from third chart.

## Motivation

Currently, it is not possible to compose charts using dependencies without leaking the structure of the values of the subcharts used. This would allow to freely structure the values the user interacts with.

## Rationale

Using the same parent chart as in the [specification](#specification) without `export-value`, the `port` value must match and must be specified twice by the user.

```yaml
# values.yaml
client:
  port: 8080

server:
  port: 8080
```

The proposed structure is not only cleaner for the user, but also less error prone since the port value is only maintained once.

## Backwards Compatibility

This change won't break any existing Helm chart since it only adds new mechanisms.

## Reference Implementation

TBD

[helm/#3242]: https://github.com/helm/helm/issues/3242
[helm/#7477]: https://github.com/helm/helm/pull/7477
[helm/#10059]: https://github.com/helm/helm/pull/10059
